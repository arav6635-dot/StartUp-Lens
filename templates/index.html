<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StartUp Lens</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=JetBrains+Mono:wght@400;700&family=Space+Mono:wght@700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-body: #030913;
      --bg-panel: #07101d;
      --bg-input: #0e1c31;
      --border: #173153;
      --text-primary: #eaf4ff;
      --text-secondary: #8ca6c8;
      --text-muted: #557198;
      --blue-main: #32a8ff;
      --blue-bright: #66c8ff;
      --blue-dim: rgba(50, 168, 255, 0.14);
      --error-bg: #39161f;
      --error-border: #b94662;
      --font-main: "Inter", sans-serif;
      --font-mono: "JetBrains Mono", monospace;
      --font-loading: "Space Mono", monospace;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font-main);
      color: var(--text-primary);
      min-height: 100vh;
      background-color: var(--bg-body);
      background-image:
        linear-gradient(rgba(22, 52, 85, 0.35) 1px, transparent 1px),
        linear-gradient(90deg, rgba(22, 52, 85, 0.35) 1px, transparent 1px),
        radial-gradient(circle at 25% 0%, rgba(32, 102, 167, 0.3), transparent 40%),
        radial-gradient(circle at 90% 20%, rgba(16, 57, 108, 0.35), transparent 35%);
      background-size: 32px 32px, 32px 32px, 100% 100%, 100% 100%;
    }

    .wrap {
      max-width: 1120px;
      margin: 0 auto;
      padding: 46px 20px 84px;
    }

    .kicker {
      text-align: center;
      font-family: var(--font-mono);
      font-size: 12px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--blue-main);
      margin-bottom: 12px;
    }

    h1 {
      margin: 0 0 16px;
      text-align: center;
      font-size: clamp(42px, 8vw, 84px);
      line-height: 0.92;
      font-weight: 800;
      letter-spacing: -1.5px;
      background: linear-gradient(180deg, #ffffff, #70b9ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-transform: uppercase;
    }

    .subtitle {
      text-align: center;
      color: var(--text-secondary);
      max-width: 860px;
      margin: 0 auto 26px;
      font-family: var(--font-mono);
      font-size: clamp(14px, 1.6vw, 19px);
      line-height: 1.45;
    }

    form {
      display: grid;
      grid-template-columns: 1fr auto auto;
      max-width: 920px;
      margin: 0 auto;
      border: 1px solid var(--border);
      background: var(--bg-panel);
      padding: 10px;
      gap: 10px;
    }

    input[type="text"], input[type="url"] {
      border: 1px solid var(--border);
      background: var(--bg-input);
      color: var(--text-primary);
      font-family: var(--font-mono);
      font-size: clamp(17px, 2vw, 26px);
      padding: 18px;
      outline: none;
      min-width: 0;
    }

    input[type="text"]:focus, input[type="url"]:focus {
      border-color: var(--blue-main);
      box-shadow: 0 0 0 2px var(--blue-dim);
    }

    button {
      border: 1px solid var(--blue-main);
      background: var(--blue-main);
      color: #03101f;
      font-family: var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.6px;
      font-size: clamp(14px, 1.6vw, 18px);
      font-weight: 700;
      padding: 0 22px;
      cursor: pointer;
    }

    .mode-toggle {
      display: inline-flex;
      border: 1px solid var(--border);
      background: var(--bg-input);
      overflow: hidden;
    }

    .mode-btn {
      border: 0;
      background: transparent;
      color: var(--text-secondary);
      font-family: var(--font-mono);
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 0.4px;
      padding: 0 14px;
      cursor: pointer;
    }

    .mode-btn.active {
      background: var(--blue-main);
      color: #03101f;
      font-weight: 700;
    }

    .meta {
      margin: 18px auto 50px;
      max-width: 920px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      color: var(--text-secondary);
      font-family: var(--font-mono);
      font-size: 14px;
    }

    .url-hint {
      max-width: 920px;
      margin: 10px auto 24px;
      color: var(--text-secondary);
      font-family: var(--font-mono);
      font-size: 13px;
    }

    .url-hint strong {
      color: var(--blue-bright);
      font-weight: 700;
    }

    .avatars { font-size: 18px; letter-spacing: 2px; }
    .counter strong { color: var(--blue-bright); font-size: 1.1em; }

    .recent-label {
      text-align: center;
      font-family: var(--font-mono);
      letter-spacing: 2px;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 16px;
      font-size: 12px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }

    .card {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      padding: 14px;
      text-decoration: none;
      color: inherit;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: border-color 0.15s ease, transform 0.15s ease;
    }

    .card:hover {
      border-color: var(--blue-main);
      transform: translateY(-2px);
    }

    .domain {
      font-family: var(--font-mono);
      font-size: 18px;
      margin-bottom: 8px;
      color: #dceeff;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

    .teaser {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.35;
      margin: 0;
    }

    .hits {
      margin-top: 12px;
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--text-muted);
    }

    .error {
      max-width: 920px;
      margin: 0 auto 18px;
      border: 1px solid var(--error-border);
      background: var(--error-bg);
      color: #ffd4df;
      padding: 12px 14px;
      font-family: var(--font-mono);
      font-size: 13px;
      line-height: 1.45;
    }

    .empty {
      text-align: center;
      color: var(--text-muted);
      font-family: var(--font-mono);
      margin-top: 22px;
      font-size: 13px;
    }

    .loading-screen {
      position: fixed;
      inset: 0;
      display: none;
      z-index: 999;
      background:
        radial-gradient(circle at 20% 5%, rgba(32, 102, 167, 0.35), transparent 40%),
        radial-gradient(circle at 90% 20%, rgba(16, 57, 108, 0.35), transparent 35%),
        var(--bg-body);
      color: var(--text-primary);
      align-items: center;
      justify-content: center;
      text-align: left;
      padding: 24px;
    }

    .loading-content {
      width: min(760px, 100%);
      padding-left: 6px;
    }

    .spinner {
      width: 64px;
      height: 64px;
      margin: 0 0 22px;
      border-radius: 50%;
      border: 6px solid #23476f;
      border-top-color: var(--blue-main);
      animation: spin 0.95s linear infinite;
    }

    .loading-title {
      font-family: var(--font-loading);
      font-size: clamp(28px, 5vw, 60px);
      line-height: 1.12;
      letter-spacing: 0.4px;
      margin-bottom: 8px;
    }

    .loading-sub {
      color: var(--text-secondary);
      margin: 0;
      font-family: var(--font-main);
      font-size: clamp(18px, 2.4vw, 46px);
      line-height: 1.35;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 980px) {
      .grid { grid-template-columns: 1fr 1fr; }
      input[type="text"], input[type="url"] { padding: 16px; }
    }

    @media (max-width: 700px) {
      form { grid-template-columns: 1fr; }
      button { padding: 14px; }
      .mode-toggle { height: 44px; }
      .grid { grid-template-columns: 1fr; }
      .meta { flex-direction: column; align-items: flex-start; }
      .loading-sub { font-size: clamp(20px, 5vw, 30px); }
    }
  </style>
</head>
<body>

  <main class="wrap">
    <div class="kicker" id="kicker-text">Roast Mode</div>
    <h1>StartUp Lens</h1>
    <p class="subtitle" id="subtitle-text">Drop your URL. We‚Äôll find every fragile claim on your landing page and use it against you.</p>
    {% if error %}
      <div class="error">{{ error }}</div>
    {% endif %}
    <form id="destroy-form" method="post" action="/destroy">
      <input type="hidden" name="mode" id="mode-input" value="roast" />
      <input type="text" name="url" placeholder="www.startup.com" autocomplete="off" required />
      <div class="mode-toggle" role="group" aria-label="Result mode">
        <button type="button" class="mode-btn active" data-mode="roast">Roast</button>
        <button type="button" class="mode-btn" data-mode="praise">Praise</button>
      </div>
      <button type="submit" id="submit-btn">Destroy It</button>
    </form>
    <div class="url-hint">You can paste <strong>startup.com</strong>, <strong>www.startup.com</strong>, or full URL. We auto-convert to HTTPS.</div>
    <div class="meta">
      <div class="avatars">‚ò†Ô∏è ü•∑ üëª ü§ñ üëπ üíÄ üòà üêç</div>
      <div class="counter"><strong>+{{ total_destroyed }}</strong> <span id="counter-copy">results generated</span></div>
    </div>


    <div class="recent-label" id="recent-label">Recent Results</div>
    {% if recent %}
      <section class="grid">
        {% for row in recent %}
          <a class="card" href="{{ url_for('result_detail', mode=row.mode, slug=row.slug) }}">
            <div>
              <div class="domain">{{ row.display_domain }}</div>
              <p class="hits" style="margin:0 0 6px 0;">{{ row.mode|upper }}</p>
              <p class="teaser">{{ row.teaser }}</p>
            </div>
            <div class="hits">{{ row.request_count }} total hits</div>
          </a>
        {% endfor %}
      </section>
    {% else %}
      <p class="empty" id="empty-msg">No roasts yet. Break the silence.</p>
    {% endif %}
  </main>

  <div class="loading-screen" id="loading-screen" aria-live="polite">
    <div class="loading-content">
      <div class="spinner"></div>
      <div class="loading-title" id="loading-title">Pulling up startup...</div>
      <p class="loading-sub" id="loading-sub">Reading every word. This won‚Äôt be pretty.</p>
    </div>
  </div>

  <script>
    const form = document.getElementById("destroy-form");
    const loadingScreen = document.getElementById("loading-screen");
    const loadingTitle = document.getElementById("loading-title");
    const loadingSub = document.getElementById("loading-sub");
    const modeInput = document.getElementById("mode-input");
    const modeButtons = Array.from(document.querySelectorAll(".mode-btn"));
    const kickerText = document.getElementById("kicker-text");
    const subtitleText = document.getElementById("subtitle-text");
    const submitBtn = document.getElementById("submit-btn");
    const recentLabel = document.getElementById("recent-label");
    const emptyMsg = document.getElementById("empty-msg");
    const modeCopy = {
      roast: {
        kicker: "Roast Mode",
        subtitle: "Drop your URL. We‚Äôll find every fragile claim on your landing page and use it against you.",
        button: "Destroy It",
        recent: "Recently Roasted",
        empty: "No roasts yet. Break the silence.",
        loadingTitle: (d) => `Pulling up ${d}...`,
        hints: [
          "Reading every word. This won‚Äôt be pretty.",
          "It takes a second to gather enough ammo."
        ]
      },
      praise: {
        kicker: "Praise Mode",
        subtitle: "Drop your URL. We‚Äôll find what your landing page does right and turn it into clear strengths.",
        button: "Praise It",
        recent: "Recently Praised",
        empty: "No praises yet. Be the first.",
        loadingTitle: (d) => `Reviewing ${d}...`,
        hints: [
          "Collecting strengths and signals.",
          "Looking for what this startup gets right."
        ]
      }
    };

    function getDomainLike(input) {
      const value = (input || "").trim().toLowerCase();
      if (!value) return "startup";
      return value.replace(/^https?:\/\//, "").split("/")[0].replace(/^www\./, "") || "startup";
    }

    function startLoading(domain) {
      const mode = modeInput.value === "praise" ? "praise" : "roast";
      const cfg = modeCopy[mode];
      loadingScreen.style.display = "flex";
      loadingTitle.textContent = cfg.loadingTitle(domain);
      loadingSub.textContent = cfg.hints[Math.floor(Math.random() * cfg.hints.length)];
    }

    function applyModeCopy(mode) {
      const cfg = modeCopy[mode] || modeCopy.roast;
      kickerText.textContent = cfg.kicker;
      subtitleText.textContent = cfg.subtitle;
      submitBtn.textContent = cfg.button;
      recentLabel.textContent = cfg.recent;
      if (emptyMsg) emptyMsg.textContent = cfg.empty;
    }

    modeButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        modeInput.value = btn.dataset.mode;
        modeButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        applyModeCopy(modeInput.value);
      });
    });
    applyModeCopy("roast");

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      const input = form.querySelector('input[name="url"]');
      const url = (input.value || "").trim();
      if (!url) return;

      startLoading(getDomainLike(url));
      try {
        const response = await fetch("/api/destroy", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url, mode: modeInput.value || "roast" })
        });
        const data = await response.json();
        if (!response.ok || !data.ok) {
          const message = encodeURIComponent(data.error || "Request failed.");
          window.location.href = "/?error=" + message;
          return;
        }
        window.location.href = data.redirect_url;
      } catch (err) {
        window.location.href = "/?error=" + encodeURIComponent("Network error while generating roast.");
      }
    });
  </script>
</body>
</html>
